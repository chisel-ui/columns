---
import { getSafeGutter, sizes, uid } from '@chisel-ui/core'
import './Columns.css'
import type { StackProps } from '@chisel-ui/stack/astro'

export interface ColumnsProps extends StackProps {
    columns?: number
    dense?: boolean
    switchAt?: number | string | keyof sizes
}

function getBreakpoint(switchAt?: number | string | keyof sizes) {
    if (!switchAt) { return undefined }

    if (switchAt in sizes) { return sizes[switchAt] }

    if (typeof switchAt === 'number') { return `${switchAt}px` }

    return switchAt
}

const { gutter = '0px', theme = {}, as: Tag = 'div', fraction = '1/2', columns = 1, dense = false, switchAt, style, ...props } = Astro.props as StackProps
const id = uid()

const maybeGutter = getSafeGutter(theme, gutter)
const maybeColumns = columns || 1
const maybeBreakpoint = getBreakpoint(switchAt)

const inlineStyle = maybeBreakpoint && `
    @media (min-width: ${maybeBreakpoint}) {
        #${id} {
            --columns: ${maybeColumns};
        }
    }
`
---

<Tag data-chisel-columns {id} style={`--gutter: ${maybeGutter};${style}`} {...props}>
    <slot />
</Tag>

{inlineStyle && (
    <style set:html={inlineStyle}></style>
)}
